---

- name: Ensure ~/.bash_profile exists
  file:
    path: "{{ bash_home }}/.bash_profile"
    state: touch

- name: Check whether ~/.bashrc is loaded from ~/.bash_profile
  command: grep -Fxq "source ~/.bashrc" {{ bash_home }}/.bash_profile
  register: check_bashrc
  ignore_errors: yes
  failed_when: no
  changed_when: no

- name: Ensure ~/.bashrc exists
  file:
    path: "{{ bash_home }}/.bashrc"
    state: touch

- name: Load ~/.bashrc from ~/.bash_profile
  blockinfile:
    dest: "{{ bash_home }}/.bash_profile"
    block: |
      if [ -f ~/.bashrc ]; then
        source ~/.bashrc
      fi
  when: check_bashrc.rc != 0
